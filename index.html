
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ª®ng d·ª•ng B√°o gi√° v26 - PDF N√¢ng cao & T√≠nh Gi√° N·ªôi Th·∫•t/QC</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìù</text></svg>">

    <link rel="stylesheet" href="style.css"> 
    
    <!-- C√ÅC TH∆Ø VI·ªÜN B√äN TH·ª® BA -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <!-- Modal ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω -->
    <div id="auth-modal" class="auth-modal-overlay" style="display: none;">
        <div class="auth-modal-content">
            <div id="auth-forms-container">
                <!-- Form ƒêƒÉng nh·∫≠p -->
                <form id="login-form">
                    <h2>ƒêƒÉng Nh·∫≠p</h2>
                    <p>ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c c√¥ng vi·ªác c·ªßa b·∫°n.</p>
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">M·∫≠t kh·∫©u</label>
                        <div class="password-wrapper">
                            <input type="password" id="login-password" required>
                            <button type="button" id="toggle-login-password" class="password-toggle" aria-label="Hi·ªán m·∫≠t kh·∫©u">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <p id="login-error" class="error-message"></p>
                    <button type="submit">ƒêƒÉng Nh·∫≠p</button>
                    <p class="auth-switch">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" id="show-signup">ƒêƒÉng k√Ω ngay</a></p>
                    <p class="auth-switch" style="margin-top: 5px;"><a href="#" id="forgot-password-link">Qu√™n m·∫≠t kh·∫©u?</a></p>
                </form>

                <!-- Form ƒêƒÉng k√Ω -->
                <form id="signup-form" style="display: none;">
                    <h2>ƒêƒÉng K√Ω</h2>
                    <p>T·∫°o t√†i kho·∫£n ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu an to√†n.</p>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">M·∫≠t kh·∫©u (√≠t nh·∫•t 6 k√Ω t·ª±)</label>
                        <input type="password" id="signup-password" required>
                    </div>
                    <p id="signup-error" class="error-message"></p>
                    <button type="submit">ƒêƒÉng K√Ω</button>
                    <p class="auth-switch">ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" id="show-login">ƒêƒÉng nh·∫≠p</a></p>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Th√¥ng b√°o H·∫øt h·∫°n -->
    <div id="expiration-modal" class="auth-modal-overlay" style="display: none;">
        <div class="auth-modal-content">
            <h2>T√†i Kho·∫£n ƒê√£ H·∫øt H·∫°n</h2>
            <p>R·∫•t ti·∫øc, t√†i kho·∫£n c·ªßa b·∫°n ƒë√£ h·∫øt h·∫°n s·ª≠ d·ª•ng. Vui l√≤ng li√™n h·ªá qu·∫£n tr·ªã vi√™n ƒë·ªÉ gia h·∫°n v√† ti·∫øp t·ª•c s·ª≠ d·ª•ng d·ªãch v·ª•.</p>
            <p>To√†n b·ªô d·ªØ li·ªáu c·ªßa b·∫°n v·∫´n ƒë∆∞·ª£c l∆∞u tr·ªØ an to√†n.</p>
            <button id="logout-expired-button" class="delete-btn">ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <!-- N·ªôi dung ch√≠nh c·ªßa ·ª©ng d·ª•ng -->
    
    <div id="app-container" class="container" style="display: none;">
        <div class="app-header">
            <h1>·ª®ng d·ª•ng T·∫°o B√°o gi√° & Gi√° Th√†nh</h1>
            <div id="auth-container" class="no-print" style="text-align: right; padding: 10px; background-color: #f0f8ff; border-radius: 5px;">
                <p id="auth-status">ƒêang k·∫øt n·ªëi...</p>
                <button id="logoutButton" style="display:none;" class="delete-btn small-btn">ƒêƒÉng xu·∫•t</button>
            </div>
        </div>

        <div class="tabs no-print">
            <button class="tab-button active" data-tab="tabQuote">B√°o Gi√°</button>
            <button class="tab-button" data-tab="tabCosting">Gi√° Th√†nh</button>
            <button class="tab-button" data-tab="tabSavedQuotes">B√°o Gi√° ƒê√£ L∆∞u</button>
            <button class="tab-button" data-tab="tabCatalog">Qu·∫£n L√Ω</button>
            <button class="tab-button" data-tab="tabSettings">C√†i ƒê·∫∑t</button>
            <button class="tab-button" data-tab="tabAdmin" id="admin-tab" style="display: none; background-color: #fff0f0; color: #dc3545; border-bottom: 3px solid transparent;">Qu·∫£n tr·ªã</button>
        </div>
        
        <!-- Tab B√°o Gi√° -->
        <div id="tabQuote" class="tab-content active">
            <h2>Th√¥ng tin Chung B√°o gi√°</h2>
            <div class="item-grid">
                <div class="form-group">
                    <label for="customerName">T√™n Kh√°ch h√†ng:</label>
                    <input type="text" id="customerName">
                </div>
                <div class="form-group">
                    <label for="customerAddress">ƒê·ªãa ch·ªâ:</label>
                    <input type="text" id="customerAddress">
                </div>
                <div class="form-group">
                    <label for="quoteDate">Ng√†y b√°o gi√°:</label>
                    <input type="date" id="quoteDate">
                </div>
            </div>

            <hr class="no-print">
            <div id="quoteItemEntryForm" class="no-print">
                <h3>Th√™m/S·ª≠a chi ti·∫øt H·∫°ng m·ª•c B√°o gi√°:</h3>
                <input type="hidden" id="editingQuoteItemIdForm">

                <div class="form-section">
                    <h4>Th√¥ng tin C∆° b·∫£n & Danh m·ª•c</h4>
                    <div class="form-group">
                        <label for="quoteItemMainCategoryInput">Ch·ªçn ho·∫∑c nh·∫≠p Danh m·ª•c ch√≠nh:</label>
                        <input type="text" id="quoteItemMainCategoryInput" list="mainCategoryDataList" placeholder="Ch·ªçn ho·∫∑c g√µ ƒë·ªÉ t·∫°o DM ch√≠nh m·ªõi...">
                        <datalist id="mainCategoryDataList"></datalist>
                    </div>
                    <div class="form-group">
                        <label for="catalogItemCombobox">1. L·ªçc v√† ch·ªçn nhanh t·ª´ danh m·ª•c:</label>
                        <input type="text" id="catalogItemCombobox" list="catalogDatalist" placeholder="G√µ ƒë·ªÉ t√¨m ho·∫∑c ch·ªçn h·∫°ng m·ª•c...">
                        <datalist id="catalogDatalist"></datalist>
                    </div>
                    <div class="form-group">
                        <label for="itemNameQuoteForm">2. T√™n H·∫°ng m·ª•c:</label>
                        <input type="text" id="itemNameQuoteForm" placeholder="V√≠ d·ª•: S∆°n Nippon">
                    </div>
                    <div class="form-group">
                        <label for="itemSpecQuoteForm">3. Quy c√°ch/M√¥ t·∫£ chi ti·∫øt:</label>
                        <textarea id="itemSpecQuoteForm" rows="2" placeholder="V√≠ d·ª•: Lo·∫°i A, m√†u X, b√≥ng m·ªù..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h4>Chi ti·∫øt ƒê∆°n gi√° & T√≠nh to√°n</h4>
                    <div class="item-grid">
                        <div class="form-group">
                            <label for="itemUnitQuoteForm">ƒê∆°n v·ªã t√≠nh:</label>
                            <input type="text" id="itemUnitQuoteForm" placeholder="V√≠ d·ª•: m¬≤, c√°i">
                        </div>
                        <div class="form-group">
                            <label for="itemPriceQuoteForm">ƒê∆°n gi√° (VNƒê):</label>
                            <input type="number" id="itemPriceQuoteForm" placeholder="0" min="0">
                        </div>
                         <div class="form-group">
                            <label for="itemDiscountValueForm">Gi·∫£m gi√° h·∫°ng m·ª•c:</label>
                            <div style="display: flex;">
                                <input type="number" id="itemDiscountValueForm" value="0" min="0" style="flex-grow: 1;">
                                <select id="itemDiscountTypeForm" style="width: 80px; margin-left: 5px; flex-shrink: 0;">
                                    <option value="percent">%</option>
                                    <option value="amount">VNƒê</option>
                                </select>
                            </div>
                        </div>
                         <div class="form-group">
                            <label for="itemCalcTypeQuoteForm">C√°ch t√≠nh gi√°:</label>
                            <select id="itemCalcTypeQuoteForm">
                                <option value="unit">Theo ƒê∆°n v·ªã (Gi√° x SL)</option>
                                <option value="length">Theo Chi·ªÅu d√†i (Gi√° x D√†i x SL)</option>
                                <option value="area">Theo Di·ªán t√≠ch (Gi√° x D√†i x Cao x SL)</option>
                                <option value="volume">Theo Th·ªÉ t√≠ch (Gi√° x D√†i x Cao x S√¢u x SL)</option>
                            </select>
                        </div>
                    </div>
                
                    <div class="item-grid-col4 dimensions-group">
                         <div class="form-group dimension-input-group" id="groupItemLengthQuoteForm" style="display:none;">
                            <label for="itemLengthQuoteForm">D√†i (mm):</label>
                            <input type="number" id="itemLengthQuoteForm" placeholder="N·∫øu c√≥" min="0" step="0.01">
                        </div>
                        <div class="form-group dimension-input-group" id="groupItemHeightQuoteForm" style="display:none;">
                            <label for="itemHeightQuoteForm">Cao (mm):</label> <input type="number" id="itemHeightQuoteForm" placeholder="N·∫øu c√≥" min="0" step="0.01">
                        </div>
                        <div class="form-group dimension-input-group" id="groupItemDepthQuoteForm" style="display:none;">
                            <label for="itemDepthQuoteForm">S√¢u (mm):</label> <input type="number" id="itemDepthQuoteForm" placeholder="N·∫øu c√≥" min="0" step="0.01">
                        </div>
                         <div class="form-group">
                            <label for="itemQuantityQuoteForm">S·ªë l∆∞·ª£ng (b·ªô/c√°i):</label>
                            <input type="number" id="itemQuantityQuoteForm" value="1" min="0.01" step="0.01">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>H√¨nh ·∫£nh & Ho√†n t·∫•t</h4>
                    <div class="form-group">
                        <label for="itemImageFileQuoteForm">H√¨nh ·∫£nh h·∫°ng m·ª•c (nh·ªè, <500KB):</label>
                        <input type="file" id="itemImageFileQuoteForm" accept="image/*">
                        <img id="itemImagePreviewQuoteForm" src="#" alt="Item Image Preview">
                    </div>
                    <button id="addOrUpdateItemButtonForm">Th√™m v√†o B√°o gi√°</button>
                    <button id="quickSaveToCatalogButtonForm" class="quick-save-to-catalog-btn" title="L∆∞u h·∫°ng m·ª•c n√†y v√†o Danh m·ª•c ch√≠nh">L∆∞u v√†o DM</button>
                    <button id="cancelEditQuoteItemButtonForm" class="clear-btn" style="display:none;">H·ªßy S·ª≠a Item</button>
                </div>
            </div>
            
            <hr>
            <h2>Chi ti·∫øt B√°o gi√° Hi·ªán t·∫°i</h2>
            <div style="overflow-x:auto;">
                <table id="quoteTablePreview">
                    <thead>
                        <tr>
                            <th style="width:4%;">STT</th>
                            <th style="width:12%;">H√¨nh ·∫£nh</th>
                            <th style="width:28%;">H·∫°ng M·ª•c / Danh M·ª•c Ch√≠nh</th> 
                            <th style="width:6%;">ƒêVT</th>
                            <th style="width:5%;">K.L∆∞·ª£ng</th>
                            <th style="width:3%;">SL</th> 
                            <th style="width:9%;">ƒê∆°n gi√°</th>
                            <th style="width:11%;">Th√†nh ti·ªÅn</th>
                            <th class="no-print" style="width: 150px;">H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="itemListPreview"></tbody>
                </table>
            </div>
            <button id="prepareNewQuoteItemButton" class="add-new-row-btn no-print" style="margin-top:10px;" title="X√≥a tr·∫Øng form tr√™n ƒë·ªÉ nh·∫≠p h·∫°ng m·ª•c m·ªõi">+ Chu·∫©n b·ªã th√™m h·∫°ng m·ª•c m·ªõi</button>
            
            <div class="total-section">
                <div class="form-group-inline">
                    <input type="checkbox" id="applyDiscountCheckbox" checked ><label for="applyDiscountCheckbox">Gi·∫£m gi√°:</label>
                    <input type="number" id="discountValueInput" value="0" min="0">
                    <select id="discountTypeSelect" style="width: 80px; margin-left: 5px;"><option value="percent">%</option><option value="amount">VNƒê</option></select>
                    <span id="discountAmount" style="min-width: 100px; text-align:left; margin-left:5px;">(0 VNƒê)</span>
                </div>
                <div class="form-group-inline">
                    <input type="checkbox" id="applyTaxCheckbox" checked ><label for="applyTaxCheckbox">Thu·∫ø VAT (%):</label>
                    <input type="number" id="taxPercent" value="0" min="0">
                    <span id="taxAmount" style="min-width: 100px; text-align:left; margin-left:5px;">(0 VNƒê)</span>
                </div>
                 <div><label>T·∫°m t√≠nh:</label><span id="subTotal">0 VNƒê</span></div>
                <hr style="margin: 10px 0; border-color: #ddd;">
                <div class="grand-total"><label>T·ªïng c·ªông:</label><span id="totalPrice">0 VNƒê</span></div>
            </div>
            
            <div class="installments-section no-print">
                <hr style="border-color: #007bff; border-width: 1px; margin-top: 25px;">
                <div class="form-group-inline" style="justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center;">
                        <input type="checkbox" id="applyInstallmentsCheckbox">
                        <label for="applyInstallmentsCheckbox" style="font-weight: bold; font-size: 1.1em; color: #007bff; margin: 0;">B·∫≠t L·ªãch thanh to√°n theo ƒë·ª£t</label>
                    </div>
                    <button id="add-installment-button" class="small-btn no-print" style="margin: 0;">+ Th√™m ƒë·ª£t</button>
                </div>
                <div id="installmentsContainer" class="installments-container" style="display: none;">
                    <div class="installment-row-header">
                        <span>N·ªôi dung ƒë·ª£t</span>
                        <span>Gi√° tr·ªã</span>
                        <span>Lo·∫°i</span>
                        <span>Th√†nh ti·ªÅn (VNƒê)</span>
                        <span style="width: 40px;"></span> <!-- C·ªôt cho n√∫t x√≥a -->
                    </div>
                    <div id="installments-list"></div>
                    <div id="installments-summary" class="installment-summary"></div>
                </div>
            </div>
            
            <div class="quote-actions-footer no-print">
                <button id="saveCurrentQuoteButton" class="save-btn">L∆∞u B√°o gi√° n√†y</button>
                <button id="previewPdfButton" style="background-color: var(--warning-color);">Xem tr∆∞·ªõc PDF</button>
                <button id="exportPdfButton" class="pdf-btn">Xu·∫•t PDF</button>
                <button id="clearQuoteButton" class="clear-btn">L√†m m·ªõi To√†n b·ªô</button>
            </div>
        </div>

        <!-- Tab Gi√° Th√†nh -->
        <div id="tabCosting" class="tab-content">
            <h2>T√≠nh to√°n Gi√° th√†nh S·∫£n ph·∫©m</h2>
            <div class="form-group">
                <label for="costingProductName">T√™n S·∫£n ph·∫©m:</label>
                <input type="text" id="costingProductName" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m...">
            </div>
             <div class="form-group">
                <label for="costingSheetId">ID Phi·∫øu t√≠nh gi√° (ƒë·ªÉ tr·ªëng s·∫Ω t·ª± t·∫°o):</label>
                <input type="text" id="costingSheetId" placeholder="V√≠ d·ª•: SP001-COST">
            </div>
            <div class="form-group">
                <label for="costingQuantityProduced">S·ªë l∆∞·ª£ng S·∫£n xu·∫•t (ƒê∆°n v·ªã SP):</label>
                <input type="number" id="costingQuantityProduced" placeholder="0" min="1" value="1">
            </div>

            <hr>
            <h3>Chi ph√≠ V·∫≠t t∆∞ Tr·ª±c ti·∫øp</h3>
            <div id="costingMaterialEntryForm" class="no-print" style="padding: 15px; border: 1px solid #e0e0e0; border-radius: var(--border-radius); background-color: #fdfdfd; margin-bottom:15px;">
                <div class="item-grid" style="grid-template-columns: 1fr 1fr; gap:15px 20px; align-items: end;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="costingMaterialName">T√™n V·∫≠t t∆∞:</label>
                        <input type="text" id="costingMaterialName" placeholder="V√°n MDF, Mica FS, LED...">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="costingMaterialSpec">Quy c√°ch/M√£ hi·ªáu:</label>
                        <input type="text" id="costingMaterialSpec" placeholder="An C∆∞·ªùng 17mm, FS 3mm Trong...">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="costingMaterialUnit">ƒêVT:</label>
                        <input type="text" id="costingMaterialUnit" placeholder="t·∫•m, m2, m√©t, c√°i">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="costingMaterialDimensions">K√≠ch th∆∞·ªõc (DxR mm):</label>
                        <input type="text" id="costingMaterialDimensions" placeholder="1220x2440 (n·∫øu c√≥)">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="costingMaterialQuantity">S·ªë l∆∞·ª£ng:</label>
                        <input type="number" id="costingMaterialQuantity" placeholder="0" min="0" step="any">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="costingMaterialPrice">ƒê∆°n gi√° (VNƒê):</label>
                        <input type="number" id="costingMaterialPrice" placeholder="0" min="0">
                    </div>
                     <div class="form-group" style="margin-bottom: 0;">
                        <label for="costingMaterialWaste">% Hao h·ª•t:</label>
                        <input type="number" id="costingMaterialWaste" value="0" min="0" placeholder="0">
                    </div>
                </div>
                <button id="addCostingMaterialButton" class="small-btn" style="margin-top:10px;">+ Th√™m V·∫≠t t∆∞</button>
            </div>
            <div style="overflow-x:auto;">
                <table id="costingMaterialsTable">
                    <thead>
                        <tr>
                            <th style="width:4%;">STT</th>
                            <th>T√™n V·∫≠t t∆∞</th>
                            <th style="width:15%;">Quy c√°ch</th>
                            <th style="width:10%;">K.Th∆∞·ªõc</th>
                            <th style="width:7%;">ƒêVT</th>
                            <th style="width:8%; text-align:right;">S·ªë l∆∞·ª£ng</th>
                            <th style="width:10%; text-align:right;">ƒê∆°n gi√°</th>
                            <th style="width:7%; text-align:right;">% HH</th>
                            <th style="width:12%; text-align:right;">Th√†nh ti·ªÅn</th>
                            <th class="no-print" style="width:8%;">X√≥a</th>
                        </tr>
                    </thead>
                    <tbody id="costingMaterialsList"></tbody>
                </table>
            </div>
            <div class="total-section-minimal">
                <strong>T·ªïng Chi ph√≠ V·∫≠t t∆∞: <span id="totalDirectMaterialsCostSpan">0 VNƒê</span></strong>
            </div>

            <hr>
            <h3>Chi ph√≠ Nh√¢n c√¥ng Tr·ª±c ti·∫øp (NCTT)</h3>
            <div id="costingLaborEntryForm" class="no-print" style="padding: 15px; border: 1px solid #e0e0e0; border-radius: var(--border-radius); background-color: #fdfdfd; margin-bottom:15px;">
                 <div class="item-grid" style="grid-template-columns: 2fr 1fr 1fr; gap:10px; align-items: end;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="costingLaborDescription">C√¥ng ƒëo·∫°n:</label>
                        <input type="text" id="costingLaborDescription" placeholder="C·∫Øt v√°n, D√°n c·∫°nh, S∆°n PU, L·∫Øp LED...">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="costingLaborHours">S·ªë gi·ªù:</label>
                        <input type="number" id="costingLaborHours" placeholder="0" min="0" step="any">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="costingLaborRate">ƒê∆°n gi√°/gi·ªù (VNƒê):</label>
                        <input type="number" id="costingLaborRate" placeholder="0" min="0">
                    </div>
                </div>
                <button id="addCostingLaborButton" class="small-btn" style="margin-top:10px;">+ Th√™m Nh√¢n c√¥ng</button>
            </div>
            <div style="overflow-x:auto;">
                <table id="costingLaborTable">
                    <thead>
                        <tr>
                            <th style="width:5%;">STT</th>
                            <th>C√¥ng ƒëo·∫°n</th>
                            <th style="width:12%; text-align:right;">S·ªë gi·ªù</th>
                            <th style="width:15%; text-align:right;">ƒê∆°n gi√°/gi·ªù</th>
                            <th style="width:18%; text-align:right;">Th√†nh ti·ªÅn</th>
                            <th class="no-print" style="width:8%;">X√≥a</th>
                        </tr>
                    </thead>
                    <tbody id="costingLaborList"></tbody>
                </table>
            </div>
            <div class="total-section-minimal">
                <strong>T·ªïng Chi ph√≠ NCTT: <span id="totalDirectLaborCostSpan">0 VNƒê</span></strong>
            </div>

            <hr>
            <h3>Chi ph√≠ S·∫£n xu·∫•t Chung (SXC)</h3>
            <div class="form-group">
                <label for="costingOverheadTotal">T·ªïng Chi ph√≠ SXC ∆Ø·ªõc t√≠nh (VNƒê):</label>
                <input type="number" id="costingOverheadTotal" placeholder="0" min="0">
            </div>

            <hr style="border-style: dashed; margin: 25px 0;">
            <div class="results-section">
                <h3>K·∫øt qu·∫£ T√≠nh to√°n Gi√° th√†nh</h3>
                <p>T·ªïng Chi ph√≠ S·∫£n xu·∫•t: <strong id="totalProductionCostSpan">0 VNƒê</strong></p>
                <p style="font-size: 1.2em; color: var(--danger-color);">Gi√° th√†nh ƒê∆°n v·ªã S·∫£n ph·∫©m: <strong id="unitProductionCostSpan">0 VNƒê</strong></p>
            </div>
            
            <div style="margin-top: 25px;" class="no-print">
                <button id="calculateCostingButton" class="save-btn">T√≠nh Gi√° Th√†nh</button>
                <button id="saveCostingButton" class="pdf-btn">L∆∞u Phi·∫øu T√≠nh Gi√°</button>
                <button id="clearCostingFormButton" class="clear-btn">L√†m m·ªõi Form</button>
            </div>

            <hr style="margin-top: 30px; margin-bottom: 15px;">
            <div id="savedCostingsSection" class="no-print">
                <h2>Phi·∫øu T√≠nh Gi√° ƒê√£ L∆∞u</h2>
                <!-- Placeholder for search/filter if needed later -->
                <!-- 
                <div class="search-filter-container no-print">
                    <div class="form-group">
                        <label for="savedCostingsSearchInput">L·ªçc phi·∫øu:</label>
                        <input type="text" id="savedCostingsSearchInput" placeholder="Nh·∫≠p ID ho·∫∑c T√™n s·∫£n ph·∫©m...">
                    </div>
                </div>
                -->
                <div style="max-height: 300px; overflow-y: auto; border: 1px solid #eee;">
                    <table id="savedCostingsTable">
                        <thead>
                            <tr>
                                <th>ID Phi·∫øu</th>
                                <th>T√™n S·∫£n ph·∫©m</th>
                                <th>Ng√†y t·∫°o</th>
                                <th>Gi√° th√†nh ƒêVSP</th>
                                <th class="no-print">H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody id="savedCostingsList">
                            <!-- Rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <!-- 
                <div id="load-more-costings-container" class="no-print" style="text-align: center; margin-top: 15px;">
                    <button id="loadMoreCostingsButton" class="small-btn">T·∫£i th√™m...</button>
                </div>
                 -->
            </div>

        </div>

        <!-- Tab B√°o Gi√° ƒê√£ L∆∞u -->
        <div id="tabSavedQuotes" class="tab-content">
            <h2>Danh s√°ch B√°o gi√° ƒê√£ l∆∞u</h2>
            
            <div class="search-filter-container no-print">
                <div class="form-group">
                    <label for="savedQuotesSearchInput">L·ªçc b√°o gi√°:</label>
                    <input type="text" id="savedQuotesSearchInput" placeholder="Nh·∫≠p ID ho·∫∑c T√™n kh√°ch h√†ng ƒë·ªÉ t√¨m ki·∫øm...">
                </div>
                <!-- C√≥ th·ªÉ th√™m c√°c b·ªô l·ªçc kh√°c ·ªü ƒë√¢y trong t∆∞∆°ng lai -->
            </div>

            <div style="max-height: 400px; overflow-y: auto; border: 1px solid #eee;">
                <table id="savedQuotesTable">
                    <thead><tr><th>ID B√°o gi√°</th><th>Kh√°ch h√†ng</th><th>Ng√†y t·∫°o</th><th>T·ªïng ti·ªÅn</th><th>Tr·∫°ng th√°i</th><th class="no-print">H√†nh ƒë·ªông</th></tr></thead>
                    <tbody id="savedQuotesList"></tbody>
                </table>
            </div>
            
            <div id="load-more-container" class="no-print" style="text-align: center; margin-top: 15px;">
                <button id="loadMoreQuotesButton" class="small-btn">T·∫£i th√™m...</button>
            </div>
        </div>

        <!-- Tab Qu·∫£n L√Ω -->
        <div id="tabCatalog" class="tab-content">
            <h2>Qu·∫£n L√Ω Danh M·ª•c S·∫£n ph·∫©m/D·ªãch v·ª•</h2>
            <div class="item-grid" style="grid-template-columns: 1fr auto; gap: 15px; align-items: center; margin-bottom: 20px;">
                <div class="form-group" style="margin-bottom: 0;">
                    <label for="excelFileManage" style="margin-bottom: 5px;">1. T·∫£i l√™n danh m·ª•c t·ª´ file Excel (.xlsx, .xls, .csv):</label>
                    <input type="file" id="excelFileManage" accept=".xlsx, .xls, .csv" style="display: none;">
                    <p style="font-size:0.85em; color:#6c757d; margin: 0;"><i>File Excel c·∫ßn c√≥ c·ªôt: `TenHangMuc`, `DonViTinh`, `DonGia`.</i></p>
                </div>
                 <button id="reloadExcelButton" class="reload-excel-btn no-print" title="M·ªü h·ªôp tho·∫°i ch·ªçn file" style="height: fit-content; margin: 0;">T·∫£i/Ch·ªçn File Danh m·ª•c</button>
            </div>

            <div class="form-group">
                <label for="catalogSearchInput">L·ªçc danh m·ª•c hi·ªán t·∫°i:</label>
                <input type="text" id="catalogSearchInput" placeholder="G√µ t√™n ho·∫∑c quy c√°ch ƒë·ªÉ l·ªçc..." style="width: 100%;">
            </div>
            <h3>Danh m·ª•c hi·ªán t·∫°i (<span id="catalogItemCount">0</span> h·∫°ng m·ª•c)</h3>
            <div style="max-height: 300px; overflow-y: auto; border: 1px solid #eee; margin-bottom:15px;">
                <table id="catalogPreviewTable">
                    <thead><tr><th>STT</th><th>T√™n H·∫°ng M·ª•c</th><th>Quy C√°ch</th><th>ƒêVT</th><th>ƒê∆°n Gi√°</th><th class="no-print">H√†nh ƒë·ªông</th></tr></thead>
                    <tbody id="catalogPreviewList"></tbody>
                </table>
            </div>
            <button id="exportCatalogButton" class="save-catalog-btn no-print">T·∫£i v·ªÅ Danh m·ª•c hi·ªán t·∫°i (Excel)</button>
            
            <hr class="no-print" style="margin-top: 30px; margin-bottom: 20px;">
            
            <div class="item-grid" style="grid-template-columns: 1fr 1fr; gap: 30px;">
                <div class="admin-section-box">
                    <h3>Qu·∫£n L√Ω Danh M·ª•c Ch√≠nh</h3>
                    <div class="form-group">
                        <label for="mainCategoryNameInput">T√™n Danh m·ª•c ch√≠nh:</label>
                        <input type="text" id="mainCategoryNameInput" placeholder="V√≠ d·ª•: H·∫°ng m·ª•c S∆°n n∆∞·ªõc">
                        <input type="hidden" id="editingMainCategoryId">
                    </div>
                     <div style="margin-bottom: 15px;">
                        <button id="addOrUpdateMainCategoryButton" class="no-print">Th√™m/C·∫≠p nh·∫≠t DM Ch√≠nh</button>
                        <button id="cancelEditMainCategoryButton" class="clear-btn no-print" style="display:none; margin-left: 5px;">H·ªßy S·ª≠a</button>
                    </div>
                    <h4>Danh s√°ch Danh m·ª•c ch√≠nh hi·ªán c√≥ (<span id="mainCategoryCount">0</span>):</h4>
                    <div style="max-height: 200px; overflow-y: auto; border: 1px solid #eee;">
                        <table id="mainCategoriesTable">
                            <thead><tr><th style="width:10%;">STT</th><th>T√™n Danh m·ª•c ch√≠nh</th><th class="no-print" style="width:20%;">H√†nh ƒë·ªông</th></tr></thead>
                            <tbody id="mainCategoriesList"></tbody>
                        </table>
                    </div>
                </div>
                <div class="admin-section-box">
                    <h3>Th√™m / S·ª≠a H·∫°ng m·ª•c trong Danh m·ª•c</h3>
                    <input type="hidden" id="editingCatalogEntryId">
                    <div class="form-group">
                        <label for="catalogEditMainCategorySelect">Danh m·ª•c ch√≠nh:</label>
                        <select id="catalogEditMainCategorySelect">
                            <option value="">-- Ch·ªçn Danh m·ª•c ch√≠nh --</option>
                        </select>
                    </div>
                    <div class="form-group"><label for="catalogEditName">T√™n H·∫°ng m·ª•c:</label><input type="text" id="catalogEditName"></div>
                    <div class="form-group"><label for="catalogEditSpec">Quy c√°ch/M√¥ t·∫£ chi ti·∫øt:</label><textarea id="catalogEditSpec" rows="2"></textarea></div>
                    <div class="item-grid" style="grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group"><label for="catalogEditUnit">ƒê∆°n v·ªã t√≠nh:</label><input type="text" id="catalogEditUnit"></div>
                        <div class="form-group"><label for="catalogEditPrice">ƒê∆°n gi√° (VNƒê):</label><input type="number" id="catalogEditPrice" min="0"></div>
                    </div>
                    <div>
                        <button id="saveCatalogEntryButton" class="no-print">Th√™m/C·∫≠p nh·∫≠t v√†o Danh m·ª•c</button>
                        <button id="cancelCatalogEntryEditButton" class="clear-btn no-print" style="display:none;">H·ªßy S·ª≠a</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab C√†i ƒê·∫∑t -->
        <div id="tabSettings" class="tab-content">
             <h2>C√†i ƒê·∫∑t Th√¥ng Tin C√¥ng Ty</h2>
             <div class="item-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group"><label for="companyNameSetting">T√™n C√¥ng ty/C√° nh√¢n:</label><input type="text" id="companyNameSetting"></div>
                <div class="form-group"><label for="companyAddressSetting">ƒê·ªãa ch·ªâ:</label><input type="text" id="companyAddressSetting"></div>
                <div class="form-group"><label for="companyPhoneSetting">ƒêi·ªán tho·∫°i:</label><input type="text" id="companyPhoneSetting"></div>
                <div class="form-group"><label for="companyEmailSetting">Email:</label><input type="email" id="companyEmailSetting"></div>
                <div class="form-group"><label for="companyTaxIdSetting">M√£ s·ªë thu·∫ø (N·∫øu c√≥):</label><input type="text" id="companyTaxIdSetting"></div>
             </div>

             <div class="form-group">
                 <label for="companyBankAccountSetting">Th√¥ng tin chuy·ªÉn kho·∫£n (Ng√¢n h√†ng, STK, Ch·ªß TK):</label>
                 <textarea id="companyBankAccountSetting" rows="3"></textarea>
             </div>
             
             <div class="form-group">
                 <label for="defaultNotesSetting">Ghi ch√∫ m·∫∑c ƒë·ªãnh cho b√°o gi√° m·ªõi:</label>
                 <textarea id="defaultNotesSetting" rows="3"></textarea>
             </div>

             <div class="form-group">
                <label for="companyLogoFile">Logo (·∫£nh nh·ªè, <1MB):</label><input type="file" id="companyLogoFile" accept="image/*"><img id="logoPreview" src="#" alt="Logo Preview">
             </div>
             
             <hr style="margin: 25px 0;">
             <h2>T√πy ch·ªânh In ·∫•n (Cho file PDF)</h2>
              <div class="item-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label for="printTitleSetting">Ti√™u ƒë·ªÅ b√°o gi√° (v√≠ d·ª•: B√ÅO GI√Å, B·∫¢NG D·ª∞ TO√ÅN,...):</label>
                    <input type="text" id="printTitleSetting" placeholder="B√ÅO GI√Å">
                </div>
                <div class="form-group">
                    <label for="printCreatorNameSetting">T√™n ng∆∞·ªùi l·∫≠p b√°o gi√° (s·∫Ω hi·ªÉn th·ªã d∆∞·ªõi ch·ªØ k√Ω):</label>
                    <input type="text" id="printCreatorNameSetting" placeholder="Nguy·ªÖn VƒÉn A">
                </div>
            </div>

            <div class="form-group setting-group-box">
                <label class="setting-group-label">·∫®n/Hi·ªán c√°c c·ªôt trong b·∫£ng PDF:</label>
                <div class="checkbox-group" style="flex-direction: row; gap: 20px; padding-top: 5px;">
                    <label><input type="checkbox" id="hideSttColumn"> STT</label>
                    <label><input type="checkbox" id="hideImageColumn"> H√¨nh ·∫£nh</label>
                    <label><input type="checkbox" id="hideMeasureColumn"> Kh·ªëi l∆∞·ª£ng</label>
                </div>
            </div>

            <div class="form-group">
                <label for="printFooterSetting">N·ªôi dung ch√¢n trang (hi·ªÉn th·ªã ·ªü cu·ªëi b·∫£n PDF):</label>
                <textarea id="printFooterSetting" rows="2"></textarea>
            </div>

             <button id="saveCompanySettingsButton" class="save-btn" style="margin-top: 15px;">L∆∞u T·∫•t C·∫£ C√†i ƒê·∫∑t</button>
             
             <hr style="margin: 25px 0;">
             <div id="account-info-container" style="display: none;">
                <h3>Th√¥ng Tin T√†i Kho·∫£n</h3>
                <div id="account-info-details">
                    <p>ƒêang t·∫£i th√¥ng tin...</p>
                </div>
             </div>
        </div>

        <!-- Tab Qu·∫£n tr·ªã -->
        <div id="tabAdmin" class="tab-content">
            <h2>Qu·∫£n l√Ω T√†i kho·∫£n Ng∆∞·ªùi d√πng</h2>
            <div class="form-group">
                <label for="admin-search-user-input">Nh·∫≠p Email ho·∫∑c User ID c·ªßa ng∆∞·ªùi d√πng c·∫ßn qu·∫£n l√Ω:</label>
                <div style="display: flex;">
                    <input type="text" id="admin-search-user-input" placeholder="Nh·∫≠p Email ho·∫∑c User ID..." style="flex-grow: 1;">
                    <button id="admin-fetch-user-button" style="margin-left: 10px; white-space: nowrap;">T√¨m ki·∫øm</button>
                </div>
            </div>

            <div id="admin-user-details-container" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px dashed #ccc;">
                <h3>Th√¥ng tin t√†i kho·∫£n</h3>
                <div id="admin-user-details"></div>
                <hr>
                <h3>C·∫≠p nh·∫≠t H·∫°n s·ª≠ d·ª•ng</h3>
                <div class="form-group">
                    <label for="admin-days-to-extend">S·ªë ng√†y mu·ªën gia h·∫°n:</label>
                    <input type="number" id="admin-days-to-extend" min="1" placeholder="Nh·∫≠p s·ªë ng√†y">
                    <input type="hidden" id="admin-target-user-id">
                </div>
                <button id="admin-update-expiry-button" class="save-btn">C·∫≠p nh·∫≠t Gia h·∫°n</button>
                <p id="admin-update-status" style="margin-top: 10px; color: green;"></p>
            </div>
        </div>
    
    </div>
    
    <!-- Loader -->
    <div id="loader" class="loader-overlay" style="display: none;">
        <div class="loader-spinner"></div>
    </div>
    <div id="notification-container"></div>
    
    <!-- T·∫£i Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>

    <!-- T·∫£i c√°c modules c·ªßa ·ª©ng d·ª•ng -->
    <script src="./js/firebase.js" type="module"></script>
    <script src="./js/dom.js" type="module"></script>
    <script src="./js/utils.js" type="module"></script>
    <script src="./js/notifications.js" type="module"></script>
    <script src="./js/auth.js" type="module"></script>
    <script src="./js/quote.js" type="module"></script>
    <script src="./js/costing.js" type="module"></script>
    <script src="./js/catalog.js" type="module"></script>
    <script src="./js/ui.js" type="module"></script>
    <script src="./js/main.js" type="module"></script>
    <script src="./js/admin.js" type="module"></script>
</body>
</html>
